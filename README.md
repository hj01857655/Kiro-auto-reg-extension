# ⚡ Kiro Account Switcher

Расширение для тех, кто устал ебаться с лимитами Kiro.

## Что делает

- **Переключение аккаунтов** — все акки в сайдбаре, тыкнул — переключился. Без перелогинов, без танцев.
- **Usage в реальном времени** — видно сколько осталось запросов, когда рефрешнется лимит.
- **Авторег новых акков** — да, прямо из расширения. Нужен IMAP доступ к почте.
- **Рефреш токенов** — автоматом или руками, как хочешь.
- **Экспорт аккаунтов** — выгрузить список в JSON.
- **Копирование токена/пароля** — в один клик.

## Установка

1. Скачать `.vsix` из [Releases](../../releases)
2. В Kiro: `Ctrl+Shift+P` → `Extensions: Install from VSIX`
3. Выбрать файл
4. Готово

## Настройка

Настройки: `Ctrl+,` → искать `kiroAccountSwitcher`

**Основное:**

- `tokensPath` — путь к папке с токенами (по умолчанию `~/.kiro-batch-login/tokens`)
- `autoSwitch.enabled` — автоматический рефреш токена перед истечением
- `autoSwitch.intervalMinutes` — за сколько минут до истечения рефрешить

**Для авторега:**

- `imap.server` — IMAP сервер (например `mail.example.com`)
- `imap.user` — логин почты
- `imap.password` — пароль почты
- `autoreg.emailDomain` — домен для новых акков
- `autoreg.headless` — скрыть браузер при регистрации

**Дебаг:**

- `debug.verbose` — подробные логи
- `debug.screenshotsOnError` — скрины при ошибках

## Структура токенов

Токены лежат в `~/.kiro-batch-login/tokens/` в формате JSON:

```json
{
  "accessToken": "...",
  "refreshToken": "...",
  "expiresAt": "2024-12-10T20:00:00.000Z",
  "accountName": "user@example.com",
  "email": "user@example.com"
}
```

## Авторег

Для авторега нужен Python 3.10+ и доступ к IMAP почты.

1. Настроить IMAP в настройках расширения
2. Нажать кнопку "Auto-Reg" в панели
3. Ждать. Браузер откроется, пройдёт регистрацию, получит код с почты, активирует аккаунт.
4. Токен автоматом сохранится

При первом запуске установятся зависимости (playwright, imap и т.д.).

## Горячие клавиши

- `Ctrl+Shift+P` → `Kiro: Switch Account` — быстрое переключение
- `Ctrl+Shift+P` → `Kiro: Open Account Dashboard` — открыть панель

## Требования

- Kiro IDE
- Node.js 18+ (для сборки)
- Python 3.10+ (для авторега)

## Сборка из исходников

```bash
npm install
npm run build
npm run package
```

Получится `.vsix` файл.

## Известные проблемы

- Иногда usage не подтягивается — нажать Refresh
- Авторег может зависнуть если капча — перезапустить
- На Linux нужен `python3` в PATH

## Лицензия

MIT. Делайте что хотите.
